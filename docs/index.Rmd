---
title: "Assessment"
output: html_document
date: "2025-11-12"
---

This project aims to look at "trends in the prescribing of dry eye disease medication across the four seasons in Scotland."

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Loading libraries

```{r}
library(tidyverse)
library(janitor)
```

Firstly, dataframes are loaded that include data of prescriptions from January to June and July to December in 2024. These dataframes are then bound together to create a single dataframe that represents the total prescriptions in 2024, which is then cleaned.

```{r}
dbb_jan_jun_2024 <- read.csv("https://www.opendata.nhs.scot/dataset/84393984-14e9-4b0d-a797-b288db64d088/resource/f0df380b-3f9b-4536-bb87-569e189b727a/download/hb_pitc2024_01_06-1.csv")

dbb_july_dec_2024 <- read.csv("https://www.opendata.nhs.scot/dataset/84393984-14e9-4b0d-a797-b288db64d088/resource/f3b9f2e2-66c0-4310-9b8e-734781d2ed0a/download/hb_pitc2024_07_12-1.csv")

dbb_jan_jun_2024$DMDCode <- as.character(dbb_jan_jun_2024$DMDCode)

dbb_2024 <- bind_rows(dbb_jan_jun_2024, dbb_july_dec_2024)

dbb_2024 <- dbb_2024 %>%
  clean_names()
```

Next, looking at the BNF Code Information - Current - October 2025 Version 88, available through this link: <https://opendata.nhsbsa.net/dataset/bnf-code-information-current-year/resource/0a2aa4d6-f4af-4adb-9c0a-ac5bc5490b23?filters=>, it is possible to filter for BNF_CHAPTER "Eye", then further filter for BNF_SUBPARAGRAPH "Tear deficiency, eye lubricant/astringent", which then reveals that the BNF item code for dry eye disease (DED) medication begins with the digits 110801, which can be used to specifically identify DED medication in the dataframe that represents total prescriptions in 2024.

```{r}
DED_med_dbb_2024 <- dbb_2024 %>%
  filter(grepl("110801", bnf_item_code))
```

This dataframe that has been filtered for the DED medications can then be grouped by month then summed to find the total paid quantity of prescriptions of DED medication for each month.

```{r}
grouped_DED_med <- DED_med_dbb_2024 %>%
  group_by(paid_date_month) %>%
    summarise(total_paid_quantity = sum(paid_quantity))
```

The months are originally given in an unpresentable form as "2024XX", which is unsuitable for a plot, so a new column is added with the corresponding last numbers, and they are then individually assigned the month's name as a string, assigned levels in order for the graph to present the months in the correct order, and given the corresponding season. The graph is then plotted using ggplot, using the month as the X axis, the total paid quantity as Y, and the color as the season in order to visualise each of the four seasons.

```{r}
grouped_DED_med <- grouped_DED_med %>%
  mutate(
    month = paid_date_month %% 100,
    
    month_name = case_when(
      month == 1  ~ "January",
      month == 2  ~ "February",
      month == 3  ~ "March",
      month == 4  ~ "April",
      month == 5  ~ "May",
      month == 6  ~ "June",
      month == 7  ~ "July",
      month == 8  ~ "August",
      month == 9  ~ "September",
      month == 10 ~ "October",
      month == 11 ~ "November",
      month == 12 ~ "December"),
    
    month_name = factor(month_name, levels = c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")),

    season = case_when(
      month %in% c(3, 4, 5)  ~ "Spring",
      month %in% c(6, 7, 8)  ~ "Summer",
      month %in% c(9, 10, 11) ~ "Autumn",
      month %in% c(12, 1, 2) ~ "Winter"))

ggplot(grouped_DED_med, aes(x = month_name, y = total_paid_quantity, group = 1, color = season)) +
  geom_line() + 
  geom_point() +
  scale_color_manual(values = c("Spring" = "green", "Summer" = "orange", "Autumn" = "brown", "Winter" = "blue")) +
  labs(
    title = "Paid Quantity of Dry Eye Disease Medication over Each Month in 2024",
    x = "Month",
    y = "Total Paid Quantity",
    color = "Season"
    )
```

-Moving forward

More analysis into the seasonal variations.

Include data from several years instead of just 2024.

Look at links of usage of allergy medicine (e.g. antihistamines) and DED medication, to determine allergy's impact.

Looking into the link of cities vs more rural towns on DED medication usage, which furthermore could look at air quality.

Looking at the impact of different climates and humidities in Scotland on DED.
